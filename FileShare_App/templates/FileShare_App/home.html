{% extends "FileShare_App/base.html" %}

{% block title %}Home{% endblock %}

{% block content %}

<div class="home-container">
    <h1>Uploaded Files</h1>

    <button class="upload-btn" onclick="window.location.href='{% url 'upload_file' %}'">Upload New File</button>

    {% if files %}
        <table id="filesTable" class="display">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>File</th>
                    <th>Uploaded At</th>
                    <th>Action Button</th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr>
                    <td>{{ file.title }}</td>
                    <td>
                        <a href="{{ file.file.url }}" style="pointer-events: none; color: black; text-decoration: none; cursor: default;">
                            {{ file.file.name|slice:'8:' }}
                        </a>
                    </td>
                    <td>{{ file.uploaded_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        <div class="actions">
                            <button class="action-btn download-btn" onclick="window.location.href='{{ file.file.url }}'">Download</button>
                            <button class="action-btn view-btn" onclick="window.location.href='{{ file.file.url }}'">View</button>
                            {% if '.xlsx' not in file.file.name and '.pdf' not in file.file.name and '.csv' not in file.file.name and '.docx' not in file.file.name and '.txt' not in file.file.name and '.pptx' not in file.file.name %}
                                <button class="action-btn delete-btn" onclick="if(confirm('Are you sure you want to delete this file?')) { window.location.href='{% url 'delete_file' file.id %}'; }">Delete</button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No files have been uploaded yet.</p>
    {% endif %}
</div>

<!-- Include DataTables CSS and JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<!-- Initialize DataTable with search + paging -->
<script>
    $(document).ready(function () {
        $('#filesTable').DataTable({
            paging: true,
            searching: true,
            info: false,
            lengthChange: false,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search files"
            }
        });
    });
</script>

{% endblock %}
